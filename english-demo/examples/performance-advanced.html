<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VTable - Performance & Advanced Features</title>
    <script src="https://unpkg.com/@visactor/vtable/dist/vtable.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .example {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .table-container {
            height: 400px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 10px 0;
        }
        .controls {
            margin: 15px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 4px;
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        .control-button {
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
        }
        .control-button:hover {
            background: #5a6fd8;
        }
        .control-button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .performance-info {
            background: #e8f5e8;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }
        .chart-container {
            height: 200px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 10px 0;
            background: #f9f9f9;
            display: flex;
            align-items: center;
            justify-content: center;
            font-style: italic;
            color: #666;
        }
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .feature-demo {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            border-left: 4px solid #667eea;
        }
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>VTable Performance & Advanced Features</h1>
        
        <div class="example">
            <h2>Large Dataset Performance Demo</h2>
            <p>This example demonstrates VTable's ability to handle large datasets efficiently with virtual scrolling.</p>
            
            <div class="controls">
                <button class="control-button" onclick="generateData(1000)">1K Records</button>
                <button class="control-button" onclick="generateData(10000)">10K Records</button>
                <button class="control-button" onclick="generateData(50000)">50K Records</button>
                <button class="control-button" onclick="generateData(100000)">100K Records</button>
                <span id="record-count">0 records loaded</span>
                <span id="render-time"></span>
            </div>
            
            <div class="performance-info">
                <strong>Performance Tips:</strong>
                <ul>
                    <li>VTable uses virtual scrolling to render only visible rows</li>
                    <li>Canvas-based rendering provides smooth scrolling even with millions of records</li>
                    <li>Built-in debouncing for search and filter operations</li>
                    <li>Efficient memory management with row recycling</li>
                </ul>
            </div>
            
            <div id="performance-table" class="table-container"></div>
        </div>

        <div class="example">
            <h2>Advanced Cell Types & Custom Renderers</h2>
            <p>Showcase of various cell types including progress bars, charts, images, and custom components.</p>
            <div id="advanced-cells-table" class="table-container"></div>
        </div>

        <div class="example">
            <h2>Pivot Table with Aggregations</h2>
            <p>Complex pivot table with multiple dimensions and calculated fields.</p>
            
            <div class="controls">
                <button class="control-button" onclick="togglePivotDimension('category')">Toggle Category</button>
                <button class="control-button" onclick="togglePivotDimension('region')">Toggle Region</button>
                <button class="control-button" onclick="switchAggregation()">Switch Aggregation</button>
            </div>
            
            <div id="pivot-table" class="table-container"></div>
        </div>

        <div class="example">
            <h2>Frozen Columns & Complex Layouts</h2>
            <p>Table with frozen columns, grouped headers, and complex cell spanning.</p>
            <div id="frozen-table" class="table-container"></div>
        </div>

        <div class="example">
            <h2>Real-time Data Updates</h2>
            <p>Live data simulation showing real-time updates with smooth animations.</p>
            
            <div class="controls">
                <button class="control-button" id="realtime-toggle" onclick="toggleRealtime()">Start Real-time Updates</button>
                <span>Update interval: </span>
                <select id="update-interval" onchange="updateInterval()">
                    <option value="1000">1 second</option>
                    <option value="2000" selected>2 seconds</option>
                    <option value="5000">5 seconds</option>
                </select>
            </div>
            
            <div id="realtime-table" class="table-container"></div>
        </div>
    </div>

    <script>
        let performanceTable, advancedCellsTable, pivotTable, frozenTable, realtimeTable;
        let realtimeInterval = null;
        let currentAggregation = 'SUM';

        // Generate sample data
        function generateLargeDataset(count) {
            const departments = ['Engineering', 'Marketing', 'Sales', 'HR', 'Finance', 'Operations'];
            const cities = ['New York', 'Los Angeles', 'Chicago', 'Houston', 'Phoenix', 'Philadelphia', 'San Antonio', 'San Diego'];
            const names = ['John', 'Jane', 'Bob', 'Alice', 'Charlie', 'Diana', 'Eva', 'Frank', 'Grace', 'Henry'];
            const surnames = ['Smith', 'Johnson', 'Williams', 'Brown', 'Jones', 'Garcia', 'Miller', 'Davis', 'Rodriguez', 'Martinez'];
            
            const data = [];
            for (let i = 0; i < count; i++) {
                data.push({
                    id: i + 1,
                    name: `${names[i % names.length]} ${surnames[i % surnames.length]}`,
                    department: departments[i % departments.length],
                    city: cities[i % cities.length],
                    salary: Math.floor(Math.random() * 100000) + 40000,
                    age: Math.floor(Math.random() * 40) + 22,
                    performance: Math.floor(Math.random() * 40) + 60,
                    startDate: new Date(2020 + Math.floor(Math.random() * 4), Math.floor(Math.random() * 12), Math.floor(Math.random() * 28)).toISOString().split('T')[0]
                });
            }
            return data;
        }

        function generateData(count) {
            const startTime = performance.now();
            
            if (performanceTable) {
                performanceTable.destroy();
            }
            
            document.getElementById('record-count').textContent = 'Loading...';
            
            // Simulate async data loading
            setTimeout(() => {
                const data = generateLargeDataset(count);
                
                performanceTable = new VTable.ListTable({
                    container: document.getElementById('performance-table'),
                    records: data,
                    columns: [
                        { field: 'id', title: 'ID', width: 80 },
                        { field: 'name', title: 'Name', width: 150 },
                        { field: 'department', title: 'Department', width: 120 },
                        { field: 'city', title: 'City', width: 120 },
                        { field: 'salary', title: 'Salary', width: 100 },
                        { field: 'age', title: 'Age', width: 70 },
                        { field: 'performance', title: 'Performance', width: 100 },
                        { field: 'startDate', title: 'Start Date', width: 120 }
                    ],
                    theme: {
                        headerStyle: {
                            bgColor: '#667eea',
                            color: '#ffffff'
                        }
                    }
                });
                
                const endTime = performance.now();
                const renderTime = Math.round(endTime - startTime);
                
                document.getElementById('record-count').textContent = `${count.toLocaleString()} records loaded`;
                document.getElementById('render-time').textContent = `Rendered in ${renderTime}ms`;
            }, 10);
        }

        function initAdvancedCellsTable() {
            const advancedData = [
                { 
                    project: 'Website Redesign', 
                    progress: 75, 
                    team: ['Alice', 'Bob', 'Carol'], 
                    priority: 'High',
                    revenue: 45000,
                    status: 'active',
                    tags: ['UI/UX', 'Frontend']
                },
                { 
                    project: 'Mobile App', 
                    progress: 90, 
                    team: ['David', 'Eva'], 
                    priority: 'Critical',
                    revenue: 78000,
                    status: 'review',
                    tags: ['Mobile', 'React Native']
                },
                { 
                    project: 'Database Migration', 
                    progress: 45, 
                    team: ['Frank', 'Grace', 'Henry'], 
                    priority: 'Medium',
                    revenue: 23000,
                    status: 'active',
                    tags: ['Backend', 'Database']
                },
                { 
                    project: 'API Development', 
                    progress: 60, 
                    team: ['Alice', 'David'], 
                    priority: 'High',
                    revenue: 67000,
                    status: 'testing',
                    tags: ['Backend', 'API']
                }
            ];

            advancedCellsTable = new VTable.ListTable({
                container: document.getElementById('advanced-cells-table'),
                records: advancedData,
                columns: [
                    { field: 'project', title: 'Project', width: 150 },
                    { 
                        field: 'progress', 
                        title: 'Progress', 
                        width: 120,
                        cellType: 'progressbar',
                        style: {
                            barColor: '#4CAF50',
                            barBgColor: '#e0e0e0'
                        }
                    },
                    { 
                        field: 'team', 
                        title: 'Team', 
                        width: 150,
                        fieldFormat(data) {
                            return Array.isArray(data) ? data.join(', ') : data;
                        }
                    },
                    { 
                        field: 'priority', 
                        title: 'Priority', 
                        width: 100,
                        style: {
                            bgColor(args) {
                                const priority = args.dataValue;
                                switch(priority) {
                                    case 'Critical': return '#ffebee';
                                    case 'High': return '#fff3e0';
                                    case 'Medium': return '#f3e5f5';
                                    default: return '#e8f5e8';
                                }
                            },
                            color(args) {
                                const priority = args.dataValue;
                                switch(priority) {
                                    case 'Critical': return '#c62828';
                                    case 'High': return '#ef6c00';
                                    case 'Medium': return '#7b1fa2';
                                    default: return '#2e7d32';
                                }
                            }
                        }
                    },
                    { 
                        field: 'revenue', 
                        title: 'Revenue', 
                        width: 100,
                        fieldFormat(data) {
                            return `$${data.toLocaleString()}`;
                        }
                    },
                    { 
                        field: 'tags', 
                        title: 'Tags', 
                        width: 150,
                        fieldFormat(data) {
                            return Array.isArray(data) ? data.map(tag => `#${tag}`).join(' ') : data;
                        }
                    }
                ]
            });
        }

        function initPivotTable() {
            const pivotData = generatePivotData();
            
            pivotTable = new VTable.PivotTable({
                container: document.getElementById('pivot-table'),
                records: pivotData,
                rows: ['category', 'region'],
                columns: ['quarter'],
                indicators: [
                    { 
                        field: 'sales', 
                        title: 'Total Sales', 
                        aggregationType: VTable.TYPES.AggregationType.SUM 
                    },
                    { 
                        field: 'profit', 
                        title: 'Average Profit', 
                        aggregationType: VTable.TYPES.AggregationType.AVG 
                    }
                ]
            });
        }

        function generatePivotData() {
            const categories = ['Electronics', 'Clothing', 'Books', 'Home'];
            const regions = ['North', 'South', 'East', 'West'];
            const quarters = ['Q1', 'Q2', 'Q3', 'Q4'];
            
            const data = [];
            for (const category of categories) {
                for (const region of regions) {
                    for (const quarter of quarters) {
                        data.push({
                            category,
                            region,
                            quarter,
                            sales: Math.floor(Math.random() * 100000) + 20000,
                            profit: Math.floor(Math.random() * 30000) + 5000
                        });
                    }
                }
            }
            return data;
        }

        function initFrozenTable() {
            const frozenData = generateLargeDataset(20);
            
            frozenTable = new VTable.ListTable({
                container: document.getElementById('frozen-table'),
                records: frozenData,
                columns: [
                    { field: 'id', title: 'ID', width: 60, frozen: 'left' },
                    { field: 'name', title: 'Name', width: 150, frozen: 'left' },
                    { 
                        title: 'Employment Details',
                        columns: [
                            { field: 'department', title: 'Department', width: 120 },
                            { field: 'startDate', title: 'Start Date', width: 120 }
                        ]
                    },
                    { 
                        title: 'Compensation',
                        columns: [
                            { field: 'salary', title: 'Base Salary', width: 100 },
                            { field: 'performance', title: 'Performance %', width: 100 }
                        ]
                    },
                    { field: 'city', title: 'Location', width: 120 },
                    { field: 'age', title: 'Age', width: 70, frozen: 'right' }
                ],
                frozenColCount: 2,
                theme: {
                    headerStyle: {
                        bgColor: '#34495e',
                        color: '#ffffff'
                    }
                }
            });
        }

        function initRealtimeTable() {
            const realtimeData = [
                { symbol: 'AAPL', price: 150.25, change: 2.15, volume: 12450000 },
                { symbol: 'GOOGL', price: 2750.80, change: -15.30, volume: 8920000 },
                { symbol: 'MSFT', price: 305.90, change: 5.45, volume: 15670000 },
                { symbol: 'TSLA', price: 892.35, change: 18.75, volume: 22340000 },
                { symbol: 'AMZN', price: 3245.60, change: -8.20, volume: 6780000 }
            ];

            realtimeTable = new VTable.ListTable({
                container: document.getElementById('realtime-table'),
                records: realtimeData,
                columns: [
                    { field: 'symbol', title: 'Symbol', width: 100 },
                    { 
                        field: 'price', 
                        title: 'Price ($)', 
                        width: 120,
                        fieldFormat(data) {
                            return `$${data.toFixed(2)}`;
                        }
                    },
                    { 
                        field: 'change', 
                        title: 'Change', 
                        width: 100,
                        style: {
                            color(args) {
                                return args.dataValue >= 0 ? '#4CAF50' : '#f44336';
                            }
                        },
                        fieldFormat(data) {
                            return `${data >= 0 ? '+' : ''}${data.toFixed(2)}`;
                        }
                    },
                    { 
                        field: 'volume', 
                        title: 'Volume', 
                        width: 120,
                        fieldFormat(data) {
                            return data.toLocaleString();
                        }
                    }
                ],
                animationAppear: {
                    duration: 300,
                    easing: 'quadInOut'
                }
            });
        }

        function toggleRealtime() {
            const button = document.getElementById('realtime-toggle');
            
            if (realtimeInterval) {
                clearInterval(realtimeInterval);
                realtimeInterval = null;
                button.textContent = 'Start Real-time Updates';
                button.style.background = '#667eea';
            } else {
                const interval = parseInt(document.getElementById('update-interval').value);
                realtimeInterval = setInterval(updateRealtimeData, interval);
                button.textContent = 'Stop Real-time Updates';
                button.style.background = '#f44336';
            }
        }

        function updateRealtimeData() {
            const records = realtimeTable.records;
            const updatedRecords = records.map(record => ({
                ...record,
                price: record.price + (Math.random() - 0.5) * 10,
                change: (Math.random() - 0.5) * 20,
                volume: record.volume + Math.floor((Math.random() - 0.5) * 1000000)
            }));
            
            realtimeTable.updateOption({ records: updatedRecords });
        }

        function updateInterval() {
            if (realtimeInterval) {
                toggleRealtime(); // Stop
                toggleRealtime(); // Start with new interval
            }
        }

        function togglePivotDimension(dimension) {
            // This would toggle dimensions in the pivot table
            console.log(`Toggle ${dimension} dimension`);
        }

        function switchAggregation() {
            currentAggregation = currentAggregation === 'SUM' ? 'AVG' : 'SUM';
            console.log(`Switched to ${currentAggregation} aggregation`);
        }

        // Initialize all tables when page loads
        document.addEventListener('DOMContentLoaded', function() {
            generateData(1000); // Start with 1K records
            initAdvancedCellsTable();
            initPivotTable();
            initFrozenTable();
            initRealtimeTable();
        });
    </script>
</body>
</html>