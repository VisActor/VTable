---
title: 2.1 Интерпретация Концепции Scenegraph    

key words: VisActor,VChart,VTable,VStory,VMind,VGrammar,VRender,Визуализация,Диаграмма,Данные,Таблица,График,ГИС,LLM
---
## Понимание Концепции SceneGraph


В VTable менеджер конфигурации `BaseTable` преобразует конфигурацию таблицы в специфическую сцену рендеринга, создавая экземпляр Scenegraph.    

И Scenegraph является носителем этого преобразования. График сцены - это относительно абстрактная концепция. По моему пониманию, график сцены можно понимать как **иерархическую графическую организационную структуру, тщательно разработанный чертеж**, способный преобразовывать абстрактные конфигурации в конкретные интерактивные, рендерируемые сети графических узлов. Как следует из названия, эта древовидная структура обеспечивает более высокую производительность, поскольку не требует пересчета графики для отрисовки во время обновлений; она только нуждается в обновлении свойств соответствующих узлов графа сцены.    

В дереве сцены каждый **узел** (Group и различные графические элементы, такие как Rect, Text, Icon) является "графической единицей", и между узлами существуют родительско-дочерние и иерархические отношения. Каждый узел может иметь свои собственные атрибуты и поведение. Эти узлы вложены и связаны друг с другом, совместно формируя полную и динамически обновляемую систему таблиц. Изменения во всем дереве немедленно отражаются в окончательном результате рендеринга, подобно тому, как корректировки в организационной структуре влияют на общие операции. 

Основная концепция дизайна дерева сцены заключается в том, что оно обеспечивает структурированный, управляемый и эффективный способ организации и рендеринга сложных графических интерфейсов.    

## Отношения классов `BaseTable` и `Scenegraph`


Можно наблюдать, что: базовый класс `BaseTable` (родительский класс специфических классов таблиц в VTable) объявлен в package/vtabvtable/src/core/BaseTable.ts, и в конструкторе базового класса `BaseTable` есть:

```xml
//省略其余代码
class BaseTable {
  constructor() {
    // создать экземпляр Scenegraph и передать экземпляр BaseTable
    this.scenegraph = new Scenegraph(this);
  }
  
  release(){
    // очистить дерево сцены при выходе из иконки
    this.scenegraph = null;
  }
}    

```
Передайте экземпляр `BaseTable` (`this`) как параметр конструктору `Scenegraph` для создания экземпляра `Scenegraph`.    

В файле package/vtabvtable/src/scenegraph/scenegraph.ts также зарегистрирован конструктор Scenegraph.    

` экземпляр table: BaseTableAPI`:    

```xml
export class Scenegraph {
  // ссылка на экземпляр таблицы
  table: BaseTableAPI;
  // экземпляр сцены
  stage: IStage;
  // 。。。другие свойства дерева сцены
  constructor(table: BaseTableAPI) {
    // сохранить переданный экземпляр table как свойство класса
    this.table = table;
    // 。。。другие операции
    this.initSceneGraph();    // подготовить основную структуру дерева сцены
    // 。。。другие операции
 
    this.createComponent();   //подготовить инфраструктуру, связанную с "выбором" и "компонентами" для таблицы
  }
  // ... другие методы
}    

```
Можно видеть, что `Scenegraph` является основным компонентом `BaseTable`, где `scenegraph` управляет взаимодействием и рендерингом таблицы, в то время как `BaseTable` отвечает за управление базовой конфигурацией и общей логикой диаграммы. `BaseTable` управляет жизненным циклом `Scenegraph`, обрабатывая создание и уничтожение дерева сцены.

В то же время оба класса должны иметь доступ к свойствам или методам друг друга: дерево сцены должно получать конфигурацию рендеринга и основную информацию `table` (опции, animationManager, тема и другие базовые конфигурации) для построения сцены, в то время как `BaseTable` полагается на `Scenegraph` для предоставления основных методов рендеринга и взаимодействия.

## Расположение Исходного Кода


*  package/vtable/src/core/BaseTable.ts: Файл определения основного класса для дерева сцены    

*  scenegraph/group-creater/progress/proxy.ts: Основной модуль оптимизации производительности VTable для решения проблемы рендеринга больших объемов данных.    

## Интерпретация Внутренних Концепций Структур Данных


Как упоминалось выше, дерево сцены является древовидной структурой, и его основными компонентами являются group-column-cell-primitive. Общая структура следующая: 

<img src='https://cdn.jsdelivr.net/gh/xuanhun/articles/visactor/sourcecode/img/LwRfbCRVUoSoy3xsFz6cFKUbnFe.gif' alt='' width='1000' height='auto'>

### Stage

Stage - это концепция из модуля VRender (https://visactor.com/vrender/guide/asd/Basic_Tutorial/Create_Instance), служащая контейнером верхнего уровня и средой рендеринга дерева сцены. Его можно понимать как виртуальное "пространство холста", отвечающее за предоставление базовой среды для рендеринга, управление процессом рендеринга всей сцены и контроль основных свойств сцены (размер, фон, соотношение пикселей) и т.д.    

* Настройка Stage:    

```javascript
constructor(table: BaseTableAPI) {
  // создание Stage
  this.stage = createStage({
    canvas: table.canvas,
    width,
    height,
    // другие конфигурации...
  });
}    

```
Для VTable Stage является основным контейнером для построения всей системы визуализации таблиц.    

* Рендеринг подузлов сцены на холст    

```javascript
    this.stage.defaultLayer.add(this.tableGroup);
    (this.stage as any).table = this.table;    

```
Сначала добавьте корневой узел таблицы (`tableGroup`) в слой по умолчанию Stage, что означает, что `tableGroup` и все его дочерние узлы будут отрендерены на холст, устанавливая прямое соединение между деревом сцены и средой рендеринга.

Затем смонтируйте экземпляр таблицы на stage, установив соединение с конфигурацией таблицы.    

### Group

Group является важным компонентом в классе дерева сцены. Чтобы понять это наглядно, группа - это узел дерева в древовидной структуре графа сцены, и это также контейнерная структура для организации и управления примитивами.

Сложность таблицы определяет, что дерево сцены требует множественных Groups, например:    

*  `colHeaderGroup`: Управление заголовками столбцов    

*  `rowHeaderGroup`: Управление заголовками строк    

*  `cornerHeaderGroup`: Группа замороженных столбцов заголовка списка    

* `bodyGroup`: Управление основным содержимым    

* `rightFrozenGroup`: Управление правой замороженной областью    

*  `bottomFrozenGroup`: Управление нижней замороженной областью    

### Primitives


Концепция примитивов происходит от VRender, это основные элементы рендеринга, которые могут формировать фактическое содержимое таблицы в VTable (элементы, такие как radio, chart, checkbox и т.д.). Например, `checkbox` можно рассматривать как комбинацию примитивов `Symbol` и примитивов `Text` и т.д.

<img src='https://cdn.jsdelivr.net/gh/xuanhun/articles/visactor/sourcecode/img/AEmib2cH3ohn9rxT7DRcfuVVnAc.gif' alt='' width='252' height='auto'>

### ProgressProxy

ProgressProxy является ядром оптимизации производительности VTable, управляющим генерацией узлов, инкрементальной загрузкой и обновлениями позиций узлов во время рендеринга первого экрана.

Это основной модуль для VTable для оптимизации производительности во время первого экрана и взаимодействия под большими объемами данных.    

## Философия Дизайна

Модуль `Scenegraph` разработан с концепцией использования дерева сцены для управления созданием и обновлением узлов сцены таблицы. Общий узел сцены таблицы - это структура дерева сцены, созданная на основе примитивов, предоставляемых VRender. Он строится слой за слоем, следуя порядку организации таблица -> заголовок/содержимое -> столбец -> ячейка -> содержимое ячейки.



# Этот документ был отредактирован и организован следующими людьми 
 [玄魂](https://github.com/xuanhun)