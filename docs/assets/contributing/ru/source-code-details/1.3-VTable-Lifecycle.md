---
title: 1.3 Жизненный Цикл VTable    

key words: VisActor,VChart,VTable,VStrory,VMind,VGrammar,VRender,Визуализация,Диаграмма,Данные,Таблица,График,ГИС,LLM
---
В предыдущих главах мы представили основные концепции и архитектуру исходного кода `@Visactor/VTable`. Однако, чтобы глубоко понять принципы работы библиотеки компонентов таблиц, нам нужно погрузиться в ее исходный код. Эта статья постепенно представит жизненный цикл `@Visactor/VTable` через пошаговую отладку, глубоко анализируя инициализацию рендеринга таблицы, процессы обновления и уничтожения в ее исходном коде, помогая читателям лучше понять и освоить жизненный цикл `@Visactor/VTable`.

<div style="заполнение:5px;фон-цвет: rgb(255, 245, 235);граница-цвет: rgb(255, 245, 235);">Расположение файлов, связанных с этим документом:    
VTable\packages\VTable\src\ListTable.ts    
VTable\packages\VTable\src\core\BaseTable.ts    
VTable\packages\VTable\src\event\EventTarget.ts    
VTable\packages\VTable\src\PivotTable.ts    
VTbale\packages\VTable\src\scenegraph\scenegraph.ts    
VTable\packages\VTable\src\scenegraph\group-creater\init-scenegraph.ts    
VTable\packages\VTable\src\scenegraph\layout\compute-row-высота.ts    
VTable\packages\VTable\src\scenegraph\group-creater\progress\proxy.ts    
VTable\packages\VTable\src\scenegraph\group-creater\progress\create-group-для-первый-screen.ts    
VTable\packages\VTable\src\scenegraph\component\table-component.ts    
VTable\packages\VTable\src\event\sparkline-event.ts    
VTbale\packages\VTable\src\state\state.ts    
VTable\packages\VTable\src\event\event.ts    
VTable\packages\VTable\src\core\utils\get-custom-merge-cell-func.ts    
</div>
### Pre-Debugging Process


If you are using VSCode, Вы можете refer к this configuration и enter Следующий settings в the .vscode file к включить debugging в VSCode.    \r

<img src='https://cdn.jsdelivr.net/gh/xuanhun/articles/visactor/sourcecode/img/W8GFbx0zVowIsWxz7wochuywnQb.gif' alt='' ширина='1000' высота='auto'>

### Application Initialization Mounting Process


Let's take `ListTable` as an example, set a breakpoint на the первый line в the `ListTable constructor`. открыть the console, и we successfully enter the constructor из `ListTable`.

*  VTable\packages\VTable\src\ListTable.ts    

<img src='https://cdn.jsdelivr.net/gh/xuanhun/articles/visactor/sourcecode/img/RR2obFrwvoFsx1xOFI8cLBi7nUh.gif' alt='' ширина='1000' высота='auto'>

It can be seen that ListTable inherits от `BaseTable` и supports three different initialization methods. After adapting к different parameters, it directly calls the super method к enter the initialization из BaseTable.

<div style="заполнение:5px;фон-цвет: rgb(255, 245, 235);граница-цвет: rgb(255, 245, 235);">The initialization из PivotTable is generally the same as that из ListTable. Both enter BaseTable directly after the constructor is compatible с different configurations, but there are некоторые differences в the creation из graphics и the initialization из variables.    
</div>
*  VTable\packages\VTable\src\PivotTable.ts    

<img src='https://cdn.jsdelivr.net/gh/xuanhun/articles/visactor/sourcecode/img/AitAbtl38ozUWcxA8c0cJxXtn0f.gif' alt='' ширина='1000' высота='auto'>

---
After entering the constructor из BaseTable, the super method is called directly, entering the initialization из EventTarget.    

*  VTable\packages\VTable\src\core\BaseTable.ts    

<img src='https://cdn.jsdelivr.net/gh/xuanhun/articles/visactor/sourcecode/img/SKpibhMS4oJPdBxma1Oc4U6rnMb.gif' alt='' ширина='1000' высота='auto'>

<img src='https://cdn.jsdelivr.net/gh/xuanhun/articles/visactor/sourcecode/img/Qxqab2Ye7oYeUFxdr51cdmtmnvb.gif' alt='' ширина='1000' высота='auto'>

The EventTarget class implements the event publish-subscribe mechanism к facilitate event notifications within the entire component.    

*  VTable\packages\VTable\src\event\EventTarget.ts    

<img src='https://cdn.jsdelivr.net/gh/xuanhun/articles/visactor/sourcecode/img/NPrLbvWPfoHqLPxZPNNcyFtkn3f.gif' alt='' ширина='1000' высота='auto'>

Continuing с debugging, we can see that most из the code в the BaseTable constructor deals с processing the configurations в options и placing them into internalProps и the BaseTable instance.    

*  VTable\packages\VTable\src\core\BaseTable.ts    

<img src='https://cdn.jsdelivr.net/gh/xuanhun/articles/visactor/sourcecode/img/RN95bhxW4oqKMZxFSzscj8snnth.gif' alt='' ширина='1000' высота='auto'>

After the data initialization из options is completed, an EventHandler instance is created. The `EventHandler` class is a more general event handler that can be used к manage event listeners для любой тип из event на любой target, making listening more efficient. When no specific event is passed в, it defaults к the изменение размера event и uses the modified `ResizeObserver` class within VTable к handle the `изменение размера` event по по умолчанию.

<img src='https://cdn.jsdelivr.net/gh/xuanhun/articles/visactor/sourcecode/img/CwCbbD8LDoHsKix6IszcMKTpnDe.gif' alt='' ширина='1000' высота='auto'>

---
After completing the initialization из the handler, the следующий core part is the creation и mounting из the element. Internally, it checks whether an element has been passed through options. If не, it creates the element using createRootElement и appends it к the container, completing the первый mounting из the element.


<div style="заполнение:5px;фон-цвет: rgb(255, 245, 235);граница-цвет: rgb(255, 245, 235);">createRootElement just creates a basic div element based на the заполнение passed в.    
</div>
*  packages\VTable\src\core\BaseTable.ts    

<img src='https://cdn.jsdelivr.net/gh/xuanhun/articles/visactor/sourcecode/img/VNJqbiy6Po7kvVx9vcJcZBBEnQf.gif' alt='' ширина='840' высота='auto'>

*  packages\VTable\src\core\BaseTable.ts    

<img src='https://cdn.jsdelivr.net/gh/xuanhun/articles/visactor/sourcecode/img/RM8ubF5Jto1SCjxa6ldctmp2nCf.gif' alt='' ширина='531' высота='auto'>

After completing the mounting из the element, the scenegraph, stateManager, и eventManager are initialized immediately, which are the scene tree, state management, и interaction event management, respectively.    

*  packages\VTable\src\core\BaseTable.ts    

<img src='https://cdn.jsdelivr.net/gh/xuanhun/articles/visactor/sourcecode/img/X8C3byrUvownnmxmxCZcBp1xnmg.gif' alt='' ширина='479' высота='auto'>

<img src='https://cdn.jsdelivr.net/gh/xuanhun/articles/visactor/sourcecode/img/P3W9wMV0Zh8BxybTUSWctg6unKd.gif' alt='' ширина='771' высота='auto'>

继续深入 scenegraph 类的初始化，我们可以看到内部使用了 VRender 的 createStage 方法创建 Stage。在 Stage 初始化的时候，传入了 afterRender 回调函数，这样在 Stage 渲染完成后，就会通过 fireListener 触发after_render 生命周期事件，这里的 after_render 就对应了文档中的 methods 中的 [after_render](https://visactor.io/VTable/api/events#AFTER_RENDER) 回调。    

*  packages\VTable\src\scenegraph\scenegraph.ts    

<img src='https://cdn.jsdelivr.net/gh/xuanhun/articles/visactor/sourcecode/img/CQUjb8PzLoWPpfxCDA3cw4COnUf.gif' alt='' ширина='1000' высота='auto'>

<img src='https://cdn.jsdelivr.net/gh/xuanhun/articles/visactor/sourcecode/img/DXaybRZcsouFzixTn0YcuwZGn4e.gif' alt='' ширина='1000' высота='auto'>

---
After the Stage is initialized, it is time для the initialization из the scene tree, elements, и the creation из components outside the table.    \r

*  packages\VTable\src\scenegraph\scenegraph.ts    

<img src='https://cdn.jsdelivr.net/gh/xuanhun/articles/visactor/sourcecode/img/OSdWbSpw1o3jM0xasmhcLWlbnNc.gif' alt='' ширина='1000' высота='auto'>

*  packages\VTable\src\scenegraph\scenegraph.ts    

<img src='https://cdn.jsdelivr.net/gh/xuanhun/articles/visactor/sourcecode/img/UiribvA8ioCPxfxvqkLc8uianKa.gif' alt='' ширина='1000' высота='auto'>

<div style="заполнение:5px;фон-цвет: rgb(255, 245, 235);граница-цвет: rgb(255, 245, 235);">关于 VRender Stage 的使用可以参考这篇文章 [🎁 VisActor Data Visualization Competition](https://visactor.io/vrender/guide/asd/Basic_Tutorial/Create_Instance)，简单来说，场景树就是通过Stage进行管理。    
</div>
Returning от SceneGraph к BaseTable, we can see that legends, подсказка, menu, dropDownMenuHighlight, и other features are initialized следующий, и finally, the размер из the Canvas is readjusted. в this point, the internal initialization из BaseTable is complete.    \r

<img src='https://cdn.jsdelivr.net/gh/xuanhun/articles/visactor/sourcecode/img/UcaXbbVX2oHgJ3xDCwpcgsoWnOg.gif' alt='' ширина='1000' высота='auto'>

---
Returning к ListTable, we can see the initialization из dataSource as well as the Title и EmptyTip components.    

*  packages\VTable\src\ListTable.ts    

<img src='https://cdn.jsdelivr.net/gh/xuanhun/articles/visactor/sourcecode/img/JMqebq6KZoPPBux8M2xcLRVcnFc.gif' alt='' ширина='1000' высота='auto'>

Pay attention к this part из the logic из the dataSource. для dataSource, VTable internally makes three judgments, analyzed от верх к низ:    \r

*  packages\VTable\src\ListTable.ts    

<img src='https://cdn.jsdelivr.net/gh/xuanhun/articles/visactor/sourcecode/img/DrcqbfCyRo2ZcsxjKr4cyRfonSe.gif' alt='' ширина='965' высота='auto'>

1. Pass dataSource directly в Options    \r

直接传入dataSource，一般在[异步懒加载数据](https://visactor.io/VTable/guide/data/async_data)的时候会用到。VTable 会直接改变实例上的 dataSource，由于 BaseTable 内部对 datasource 进行了代理，这个操作将会触发 createSceneGraph 和 render 方法；BaseTable 上的 render 方法，本质上就是调用 Stage 上的 render 方法，将 canvas 绘制到指定元素。    

*  packages\VTable\src\core\BaseTable.ts    

<img src='https://cdn.jsdelivr.net/gh/xuanhun/articles/visactor/sourcecode/img/V7AfbFnXloVP4dxhfnTcXX97nhe.gif' alt='' ширина='1000' высота='auto'>

1. Neither records nor dataSource и records are provided в Options


в both cases, setRecords is called. в setRecords, we see two familiar methods, createSceneGraph и render. в this logical judgment, the rendering из the table is completed.    \r

*  packages\VTable\src\ListTable.ts    

<img src='https://cdn.jsdelivr.net/gh/xuanhun/articles/visactor/sourcecode/img/GpQ7b4OMNoP98Exn7tKcLiT5nEc.gif' alt='' ширина='1000' высота='auto'>

---
After analyzing the general processing flow из dataSource, let's go back и see what createSceneGraph does internally:    \r

1. It can be seen that special handling is done internally для the pivot table, и a SceneProxy is instantiated. The `proxy.ts` file defines a `SceneProxy` class, which is responsible для calculating the maximum число из rows и columns в the scene tree, progressive загрузка из the scene tree, и creating the первый screen group, among other logic.    

*  packages\VTable\src\scenegraph\scenegraph.ts    

<img src='https://cdn.jsdelivr.net/gh/xuanhun/articles/visactor/sourcecode/img/UXcFb3zvfo18RKxRDCFckqVHnZc.gif' alt='' ширина='1000' высота='auto'>

1. After the proxy instance is initialized, the `createGroupForFirstScreen` method is called. The `createGroupForFirstScreen` функция is mainly used к initialize the **первый screen rendering area из the Canvas table**. It is responsible для calculating the число из rows и columns needed для the первый screen, constructing the header, freezing rows и columns, filling core drawing units (Groups) such as the main area, creating и adjusting the styles из cell elements, dynamically calculating row и column sizes, handling the layout из frozen areas according к configuration, и implementing block rendering strategies, achieving high-performance initial rendering.    

*  packages\VTable\src\scenegraph\scenegraph.ts    

<img src='https://cdn.jsdelivr.net/gh/xuanhun/articles/visactor/sourcecode/img/UsM0brFm4omOHexxWyqcDQrGndc.gif' alt='' ширина='700' высота='auto'>

*  packages\VTable\src\scenegraph\group-creater\progress\create-group-для-первый-screen.ts    

<img src='https://cdn.jsdelivr.net/gh/xuanhun/articles/visactor/sourcecode/img/DqH9bfBibo3iVhxWOHIc32vSnHE.gif' alt='' ширина='1000' высота='auto'>

*  packages\VTable\src\scenegraph\group-creater\progress\create-group-для-первый-screen.ts    

<img src='https://cdn.jsdelivr.net/gh/xuanhun/articles/visactor/sourcecode/img/Eym7bijCdoCMz1xtyKTcDdeEnHd.gif' alt='' ширина='879' высота='auto'>

<img src='https://cdn.jsdelivr.net/gh/xuanhun/articles/visactor/sourcecode/img/XH0zbfQhloobUQxC7v5coALanhc.gif' alt='' ширина='1000' высота='auto'>

1. After completing the creation из the первый screen group, afterScenegraphCreated is called к automatically adjust the row высота и column ширина, completing the adjustment из the scene graph для the render method.    

*  packages\VTable\src\scenegraph\group-creater\progress\create-group-для-первый-screen.ts    

<img src='https://cdn.jsdelivr.net/gh/xuanhun/articles/visactor/sourcecode/img/YC5abzMZIorJBjxpefIcXP9knah.gif' alt='' ширина='846' высота='auto'>

---
After completing the rendering из the table и the initialization из каждый component, trigger the INITIALIZED обратный вызов through fireListeners в the последний row из ListTable к complete the final step из the lifecycle, thus completing the initialization.    

*  packages\VTable\src\ListTable.ts    

<img src='https://cdn.jsdelivr.net/gh/xuanhun/articles/visactor/sourcecode/img/NzqGbDR0wowsMXxnnF8cysySnkf.gif' alt='' ширина='1000' высота='auto'>

*  General flowchart    

![](https://cdn.jsdelivr.net/gh/xuanhun/articles/visactor/sourcecode/img/MtUYwkfgehXJOmbBNdhct1fknMh.gif)

### Update Process


VTable 提供了五种方法用于更新配置，本次我们从最常用的 [updateOption](https://visactor.io/VTable/api/Methods#updateOption) 方法切入。    

<img src='https://cdn.jsdelivr.net/gh/xuanhun/articles/visactor/sourcecode/img/E4BJbIjOuoYfMex4hTDcwGA0nIb.gif' alt='' ширина='383' высота='auto'>

Through breakpoint analysis, it was found that the updateOption method из the parent class BaseTable из ListTable was directly called в the beginning.    

<img src='https://cdn.jsdelivr.net/gh/xuanhun/articles/visactor/sourcecode/img/Ms9YbMRMfo1EqbxIN1mc0znnnkd.gif' alt='' ширина='674' высота='auto'>

Enter BaseTable, первый extract the common attributes из tables `ListTable` и `PivotTable` от options, then update the pixel ratio и заполнение. следующий, update various attributes, including `widthMode`, `heightMode`, etc.

*  packages\VTable\src\core\BaseTable.ts    

<img src='https://cdn.jsdelivr.net/gh/xuanhun/articles/visactor/sourcecode/img/PBvObXtlBoEMzfxB8BXciyVnn1c.gif' alt='' ширина='1000' высота='auto'>

It will also clear configurations such as row высота и column ширина.    \r

<img src='https://cdn.jsdelivr.net/gh/xuanhun/articles/visactor/sourcecode/img/VgktbCIPBoezGrx44BYcVi6jnAh.gif' alt='' ширина='1000' высота='auto'>

Adjust theme и Icon configuration.    

<img src='https://cdn.jsdelivr.net/gh/xuanhun/articles/visactor/sourcecode/img/MG9IbtcJ5o49q7x6Bd8cS59inXj.gif' alt='' ширина='1000' высота='auto'>

Adjust the фон цвет.    

<img src='https://cdn.jsdelivr.net/gh/xuanhun/articles/visactor/sourcecode/img/Gkl4bDF9UoBzoKxG0JncCC1ZnSh.gif' alt='' ширина='762' высота='auto'>

Release the старый title, legend, emptyTip, и layoutMap instances, while calling `sceneGraph.clearCells` к clear the cells.    

*  packages\VTable\src\core\BaseTable.ts    

<img src='https://cdn.jsdelivr.net/gh/xuanhun/articles/visactor/sourcecode/img/CrR8bKRGyoWnUixnBh4cxIYgnne.gif' alt='' ширина='533' высота='auto'>

*  packages\VTable\src\scenegraph\scenegraph.ts    

<img src='https://cdn.jsdelivr.net/gh/xuanhun/articles/visactor/sourcecode/img/HAvEbOjZmoEdudx8f1ZcACz6nnh.gif' alt='' ширина='554' высота='auto'>

According к the новый configuration, calling `updateComponent`, `updateComponent` internally will call `scenegraph.updateComponent`, и в scenegraph, it continues к call `updateStyle` к update the styles из components outside the table. This update includes scrollbars, перетаскивание reference lines, и frozen column shadows, etc.

*  packages\VTable\src\core\BaseTable.ts    

<img src='https://cdn.jsdelivr.net/gh/xuanhun/articles/visactor/sourcecode/img/Il93br7msob846xrCh2c9iacnKg.gif' alt='' ширина='521' высота='auto'>

*  packages\VTable\src\scenegraph\scenegraph.ts    

<img src='https://cdn.jsdelivr.net/gh/xuanhun/articles/visactor/sourcecode/img/Gje5bgINnoyTMAxbsfKcWZmfng6.gif' alt='' ширина='340' высота='auto'>

*  packages/VTable/src/scenegraph/component/table-component.ts    

<img src='https://cdn.jsdelivr.net/gh/xuanhun/articles/visactor/sourcecode/img/EdtXbzZcGo2a4Mxo9kHc3wbSngg.gif' alt='' ширина='1000' высота='auto'>

After updating the external component styles, call updateOptionSetState к refresh the configuration в the State, including highlight mode, frozen column status, навести и выбрать status.    

*  packages\VTable\src\core\BaseTable.ts    

<img src='https://cdn.jsdelivr.net/gh/xuanhun/articles/visactor/sourcecode/img/NEMnbIktooOlYgxAGaZcUECmnVb.gif' alt='' ширина='627' высота='auto'>

*  packages\VTable\src\state\state.ts    

<img src='https://cdn.jsdelivr.net/gh/xuanhun/articles/visactor/sourcecode/img/GJiFb62pUoOq3jxWLNDcQdJNnJe.gif' alt='' ширина='741' высота='auto'>

Then recalculate the ширина и высота из the `canvas` through `this._updateSize`. Then call `this.eventManager.updateEventBinder` к update the binding из прокрутка events и текст adhesion.


*  packages\VTable\src\event\event.ts    

<img src='https://cdn.jsdelivr.net/gh/xuanhun/articles/visactor/sourcecode/img/MZIUbSxteoxDDZx9tnpcvhWMncf.gif' alt='' ширина='938' высота='auto'>

Inside `updateEventBinder`, it will also update the навести event state для the bound mini-map тип.    

<img src='https://cdn.jsdelivr.net/gh/xuanhun/articles/visactor/sourcecode/img/OAGMbAZK4o40TJxSHOvcuFtwnyd.gif' alt='' ширина='499' высота='auto'>

*  packages\VTable\src\event\sparkline-event.ts    

<img src='https://cdn.jsdelivr.net/gh/xuanhun/articles/visactor/sourcecode/img/B2Bhbt6eKo4juUxHOBOcv2bOn3m.gif' alt='' ширина='1000' высота='auto'>

---
следующий, update the configurations для legend, подсказка, выпадающий список menu, etc. в sequence;    \r

<img src='https://cdn.jsdelivr.net/gh/xuanhun/articles/visactor/sourcecode/img/ObF7bZOD9o5xWhxYhQXcJ04zntU.gif' alt='' ширина='851' высота='auto'>

Clear cell styles, column ширина, и row высота cache;    \r

<img src='https://cdn.jsdelivr.net/gh/xuanhun/articles/visactor/sourcecode/img/PA6YbELhhomnZMxhdiHcVhInn4b.gif' alt='' ширина='610' высота='auto'>

更新自定义单元格合并规则（[customMergeCell](https://visactor.io/VTable/option/ListTable#customMergeCell)）    

<img src='https://cdn.jsdelivr.net/gh/xuanhun/articles/visactor/sourcecode/img/M2BbbCMQHoM5GpxGmLlcnLz1nCf.gif' alt='' ширина='840' высота='auto'>

*  packages\VTable\src\core\utils\get-custom-merge-cell-func.ts    

<img src='https://cdn.jsdelivr.net/gh/xuanhun/articles/visactor/sourcecode/img/Pl6HbKPAjoRgNCxHHXkcUrqYnef.gif' alt='' ширина='998' высота='auto'>

Finally, изменение размера the canvas. в this point, the updateOption inside BaseTable is complete, returning к the inside из ListTable;

<img src='https://cdn.jsdelivr.net/gh/xuanhun/articles/visactor/sourcecode/img/Fp9abgIxzoWqOkx4n1vcl20en9T.gif' alt='' ширина='588' высота='auto'>

первый, the pagination configuration, sortState, dataConfig, showHeader, и columns configuration were updated;    \r

*  packages\VTable\src\ListTable.ts    

<img src='https://cdn.jsdelivr.net/gh/xuanhun/articles/visactor/sourcecode/img/WeAGbLDuDoqjDCxH2wgciQ0gnFM.gif' alt='' ширина='901' высота='auto'>

Then use `generateAggregationForColumn` к update the aggregation configuration для каждый column;    

<img src='https://cdn.jsdelivr.net/gh/xuanhun/articles/visactor/sourcecode/img/BG2Gb9iNuoOyZdx3Q8JcOXJXn7b.gif' alt='' ширина='603' высота='auto'>

Handle transposition, call `refreshHeader` к update the header, update column ширина configuration;    

<img src='https://cdn.jsdelivr.net/gh/xuanhun/articles/visactor/sourcecode/img/SpZWbrRPgo4sIWxjdKXcSd54ndd.gif' alt='' ширина='841' высота='auto'>

Clear `releaseList`;    

<img src='https://cdn.jsdelivr.net/gh/xuanhun/articles/visactor/sourcecode/img/YXnqboICFo700lx7XVZc2gX3n5c.gif' alt='' ширина='906' высота='auto'>

Adjusting the dataSource, или calling setRecords, или directly calling the render method, as mentioned earlier, все three methods can directly trigger table rendering. по this time, the table update is basically complete.    \r

<img src='https://cdn.jsdelivr.net/gh/xuanhun/articles/visactor/sourcecode/img/QQiHbD2PDow9jMxVXC6c47NfnSD.gif' alt='' ширина='824' высота='auto'>

After updating the data source, the `title` и `emptyTip` instances were regenerated. It should be noted that the старый `title` и `emptyTip` were already released during the updateOption process в BaseTable;

<img src='https://cdn.jsdelivr.net/gh/xuanhun/articles/visactor/sourcecode/img/Bz6Pbtd6noUJ1sxLwGbc6ZzHnae.gif' alt='' ширина='929' высота='auto'>

Due к the asynchronous rendering operations contained internally, VTable ensures that the table component rendering is completed when await updateOption по returning a Promise в the конец из updateOption. в this point, the full update из VTable is complete.    \r

<img src='https://cdn.jsdelivr.net/gh/xuanhun/articles/visactor/sourcecode/img/XxcDbN0VRocTaJxQI7vcm9jdnXe.gif' alt='' ширина='706' высота='auto'>

*  General flowchart    

![](https://cdn.jsdelivr.net/gh/xuanhun/articles/visactor/sourcecode/img/CfZow5lBdhVkpsb63MCcf2hGnke.gif)

### Destruction Process


Understanding the update mechanism is key к maintaining data, и complete lifecycle management also requires a standardized destruction process. When tables are no longer needed, they should be proactively released through the destruction process к avoid memory leaks и resource waste.

VTable 实例提供了 [release](https://visactor.io/VTable/api/Methods#release) 方法用于销毁表格事例。    

<img src='https://cdn.jsdelivr.net/gh/xuanhun/articles/visactor/sourcecode/img/GG58bIa2Jof3EWxESDJcwI0qnHd.gif' alt='' ширина='1000' высота='auto'>

по searching в the file, it can be found that release is defined в the BaseTable class. в the beginning, it checks whether it is в the process из being destroyed through the isReleased field к avoid repeated unloading из instances. The следующий three lines из code respectively destroy the tooltipHandler и menuHandler instances.    

*  VTable\packages\VTable\src\core\BaseTable.ts    

<img src='https://cdn.jsdelivr.net/gh/xuanhun/articles/visactor/sourcecode/img/L8kvbAWFjo4rB5x1bvUcxYrtnCg.gif' alt='' ширина='568' высота='auto'>

Then the release method из the parent class is called. As mentioned above, BaseTable inherits от EventTarget, so essentially it calls `EventTarget.release` к release все subscribed events.

*  VTable\packages\VTable\src\event\EventTarget.ts    

<img src='https://cdn.jsdelivr.net/gh/xuanhun/articles/visactor/sourcecode/img/R89hbhvLvokiPFx2WnpchywenHh.gif' alt='' ширина='601' высота='auto'>

Subsequently, release the EventHandler instance, eventManager, focusControl, legends, title, emptyTip, layoutMap, stage, и proxy в sequence. After completing the release, call parentElement.removeChild к remove the mounted DOM element.    \r

<div style="заполнение:5px;фон-цвет: rgb(255, 245, 235);граница-цвет: rgb(255, 245, 235);">The Stage.release method is located within VRender, primarily used к destroy the entire Stage и clear the chart. в this step, the chart content has already disappeared.    
</div>
*  VTable\packages\VTable\src\core\BaseTable.ts    

<img src='https://cdn.jsdelivr.net/gh/xuanhun/articles/visactor/sourcecode/img/W7Xbb6aqvo8nQ5xJZtCcN4Ydnuf.gif' alt='' ширина='850' высота='auto'>

After releasing the above components, update the isReleased status к avoid repeated release operations; clear the scene tree и internalProps. This completes the entire destruction process из the table component.    \r

<img src='https://cdn.jsdelivr.net/gh/xuanhun/articles/visactor/sourcecode/img/JDmHbyk2joDSP5xt0bYcDUi2nmD.gif' alt='' ширина='661' высота='auto'>

### Summary


#### 1. Initialization Process

**Core Process**    

*  **Entry**: `ListTable`/`PivotTable` constructor inherits `BaseTable`, processes configuration parameters, и then calls `super()` к enter parent class initialization.    

*  **Event Initialization**: `BaseTable` inherits `EventTarget` к implement an event subscription mechanism, supporting events like `изменение размера`.    

*  **DOM Mounting**: Create a root element `div` и mount it к the container, serving as the container для table rendering.    

*  **Scene Graph Construction**: Create `VRender Stage` through the `scenegraph` module к manage the rendering tree и первый-screen rendering logic.    

* первый screen rendering: `createGroupForFirstScreen` creates the header, freezes rows и columns, main area elements, и dynamically calculates row и column dimensions.

*  Proxy rendering: `SceneProxy` manages progressive rendering strategies к optimize performance.    

*  **Data Source Processing**: Trigger `createSceneGraph` и `render` based на `dataSource` или `records` к complete the initial rendering.    

*  **обратный вызов Trigger**: Trigger the `INITIALIZED` event through `fireListeners`, marking the completion из initialization.    

**Key Document**    

*  `ListTable.ts`/`PivotTable.ts`: Entry class, handles table тип differences.    

* `BaseTable.ts`: Core configuration processing, DOM mounting, scene graph/state/event manager initialization.    

*  `scenegraph.ts`: Scene tree management, interacts с `VRender`.    

*  `create-group-для-первый-screen.ts`: Implementation из the первый screen rendering logic.    

---
#### 2. Update Process


**Core Process**    

*  **Entry Method**: `updateOption` triggers a full update.    

*  **Configuration Update**:    

* Update general properties (theme, размер mode, фон, etc.).    \r

*  Clear cache (row высота, column ширина, cell style).    \r

*  Release старый components (title, legend, layout mapping).    

*  **Scene Reconstruction**:    

*  Call `sceneGraph.clearCells` к clear cells.    

*  Recreate components (scrollbars, freeze shadows) и update styles.    \r

*  **State Synchronization**: Update interaction states such as highlight, selection, и freeze.    \r

*  **Asynchronous Rendering**: Ensure rendering completion с `Promise`, supports `await` synchronization.    

**Key Document**    

*  `BaseTable.ts`: Configuration update main logic.    

* `state.ts`: State management module.    

*  `sparkline-event.ts`: Sparkline event handling.    

---
#### 3. Destruction Process

**Core Process**    

*  **Entry Method**: `release()`    

*  **Resource Release**:    

* Remove event listeners: Unsubscribe все по using `EventTarget.release()`.    

* Destroy DOM elements: remove the root node и Canvas.    

* Clean up components: Release instances из `подсказка`, `Menu`, etc.    

*  **Memory Reclamation**: Clear the scene tree, data references, trigger GC.    \r

**Key Design**    

* Defensive judgment: Avoid repeated destruction по using the `isReleased` flag.    

* Hierarchical release: Clean up step по step от child components к parent class к ensure no residual references.    \r

**Key Document**    

*  `BaseTable.ts`: Implementation из the `release()` method.    

*  `EventTarget.ts`: Event system destruction logic.    

# This document is provided по Следующий personnel


taiiiyang（https://github.com/taiiiyang）    



# This document was revised и organized по Следующий personnel 
 [玄魂](https://github.com/xuanhun)